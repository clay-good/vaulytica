version: '3.8'

services:
  vaulytica:
    build: .
    image: vaulytica:latest
    container_name: vaulytica
    volumes:
      # Mount config directory
      - ./config:/app/config:ro
      # Mount reports directory
      - ./reports:/app/reports
      # Mount logs directory
      - ./logs:/app/logs
      # Mount credentials (read-only)
      - ./credentials:/app/credentials:ro
    environment:
      - VAULYTICA_CONFIG=/app/config/config.yaml
      - PYTHONUNBUFFERED=1
    # Override command for different operations
    # command: scan files --domain example.com
    command: --help

  # Scheduled scanner (runs daily at 2 AM)
  vaulytica-cron:
    build: .
    image: vaulytica:latest
    container_name: vaulytica-cron
    volumes:
      - ./config:/app/config:ro
      - ./reports:/app/reports
      - ./logs:/app/logs
      - ./credentials:/app/credentials:ro
    environment:
      - VAULYTICA_CONFIG=/app/config/config.yaml
      - PYTHONUNBUFFERED=1
    # Install cron and run scheduled scans
    entrypoint: /bin/sh
    command: -c "echo '0 2 * * * vaulytica scan files --domain example.com' | crontab - && crond -f"
    restart: unless-stopped

